/* Disable results caching */
set enable_result_cache_for_session to off;

/* TPC_H  Query 9 - Product Type Profit Measure */
set query_group='RSPERF TPC-H 1.9';
SELECT	/* sql-9 */ TOP 100000 NATION,
	O_YEAR,
	SUM(AMOUNT)	AS SUM_PROFIT
FROM	(	SELECT	N_NAME							AS NATION,
			extract(year from o_orderdate) as o_year,
			L_EXTENDEDPRICE*(1-L_DISCOUNT)-PS_SUPPLYCOST*L_QUANTITY	AS AMOUNT
		FROM	PART,
			SUPPLIER,
			LINEITEM,
			PARTSUPP,
			ORDERS,
			NATION
		WHERE	S_SUPPKEY	= L_SUPPKEY AND
			PS_SUPPKEY	= L_SUPPKEY AND
			PS_PARTKEY	= L_PARTKEY AND
			P_PARTKEY	= L_PARTKEY AND
			O_ORDERKEY	= L_ORDERKEY AND
			S_NATIONKEY	= N_NATIONKEY AND
			P_NAME		LIKE '%green%'
	)	AS PROFIT
GROUP	BY	NATION,
		O_YEAR
ORDER	BY	NATION,
		O_YEAR	DESC;